"use client";

import { memo, useCallback, useEffect, useMemo, useRef, useState } from "react";
import { 
	Router, 
	Wifi, 
	Network, 
	Server, 
	Radio, 
	Globe, 
	Truck, 
	Box, 
	MessageCircle, 
	ChevronRight, 
	Check, 
	Shield, 
	Award, 
	Cpu,
	X,
	Phone,
	Mail,
	MapPin
} from "lucide-react";

// Define types for product
interface Product {
	name: string;
	category: string;
	icon: React.ComponentType<{ className?: string }>;
	series: string;
	specs: string[];
	description: string;
	useCase: string;
}

const WHATSAPP_NUMBER = "971502474482";

const HERO_SLIDES = [
	{
		title: "Official MikroTik® Master Distributor",
		subtitle: "Authorized distribution for UAE, GCC & Global Markets",
		badge: "Master Distributor"
	},
	{
		title: "Enterprise-Grade Network Infrastructure",
		subtitle: "From edge routing to 100G core switching",
		badge: "B2B Excellence"
	},
	{
		title: "B2B Distribution Excellence",
		subtitle: "Volume pricing, technical training & expert support",
		badge: "Certified Partner"
	},
];

const PRODUCTS: Product[] = [
	// Routers
	{
		name: "CCR2004-1G-12S+2XS",
		category: "Routers",
		icon: Router,
		series: "Cloud Core Router",
		specs: [
			"4-core ARM CPU @ 1.7GHz",
			"12x 10G SFP+ ports",
			"2x 25G SFP28 ports",
			"1GB RAM",
			"Dual redundant PSU",
			"1U rackmount"
		],
		description: "ISP backbone router for demanding networks",
		useCase: "ISP core routing, data center interconnect, high-throughput edge routing"
	},
	{
		name: "hAP ax³",
		category: "Routers",
		icon: Router,
		series: "Home Access Point",
		specs: [
			"Wi-Fi 6 (802.11ax)",
			"2.4GHz + 5GHz dual-band",
			"PoE-in support",
			"2.5G Ethernet port",
			"4x Gigabit ports",
			"USB 3.0 port"
		],
		description: "Wi-Fi 6 SOHO router with modern connectivity",
		useCase: "Small office, home office, retail outlets, guest Wi-Fi"
	},
	{
		name: "RB5009UG+S+IN",
		category: "Routers",
		icon: Router,
		series: "RouterBOARD",
		specs: [
			"8x Gigabit Ethernet",
			"1x 2.5G Ethernet",
			"1x 10G SFP+ cage",
			"PoE-in & PoE-out",
			"Desktop enclosure",
			"Quad-core CPU @ 1.4GHz"
		],
		description: "Universal SMB router with fiber uplink",
		useCase: "Enterprise branch, managed network edge, SMB gateway"
	},
	// Switches
	{
		name: "CRS518-16XS-2XQ-RM",
		category: "Switches",
		icon: Network,
		series: "Cloud Router Switch",
		specs: [
			"16x 25G SFP28 ports",
			"2x 100G QSFP28 ports",
			"L3 hardware switching",
			"1U rackmount",
			"Marvell Prestera 98DX8525",
			"Hot-swap PSU option"
		],
		description: "100G enterprise switch for demanding environments",
		useCase: "Data center ToR, high-bandwidth aggregation, 100G backbones"
	},
	{
		name: "CRS326-24G-2S+RM",
		category: "Switches",
		icon: Network,
		series: "Cloud Router Switch",
		specs: [
			"24x Gigabit Ethernet",
			"2x 10G SFP+ ports",
			"L2/L3 switching",
			"1U rackmount",
			"RouterOS + SwOS dual boot",
			"Non-blocking throughput"
		],
		description: "24-port managed switch with 10G uplinks",
		useCase: "Office networks, IP camera systems, access layer switching"
	},
	{
		name: "CSS610-8G-2S+IN",
		category: "Switches",
		icon: Network,
		series: "Cloud Smart Switch",
		specs: [
			"8x Gigabit Ethernet",
			"2x 10G SFP+ ports",
			"SwOS (web managed)",
			"Desktop enclosure",
			"PoE-in support",
			"Fanless design"
		],
		description: "Compact SMB switch with simple management",
		useCase: "Small networks, desktop aggregation, PoE cameras"
	},
	// Wireless
	{
		name: "Audience",
		category: "Wireless",
		icon: Wifi,
		series: "Wi-Fi 6 Access Point",
		specs: [
			"Wi-Fi 6 (802.11ax)",
			"Tri-radio design",
			"2.4GHz + 5GHz + 5GHz",
			"PoE powered",
			"Ceiling mount",
			"MU-MIMO & OFDMA"
		],
		description: "Tri-radio professional AP for high-density",
		useCase: "Hotels, conference centers, offices, high-capacity venues"
	},
	{
		name: "wAP ax",
		category: "Wireless",
		icon: Wifi,
		series: "Wireless Access Point",
		specs: [
			"Wi-Fi 6 (802.11ax)",
			"Outdoor rated (IP65)",
			"2x2 MIMO",
			"Gigabit Ethernet",
			"PoE-in",
			"Compact weatherproof"
		],
		description: "Outdoor Wi-Fi 6 AP for harsh environments",
		useCase: "Outdoor coverage, industrial sites, temporary deployments"
	},
	{
		name: "LHG 5 ac",
		category: "Wireless",
		icon: Radio,
		series: "Light Head Grid",
		specs: [
			"5GHz 802.11ac",
			"Integrated 24.5dBi antenna",
			"Long-range PtP links",
			"PoE powered",
			"Weatherproof housing",
			"Dual-chain design"
		],
		description: "PtP link with integrated high-gain antenna",
		useCase: "Point-to-point links, WISP backhaul, remote site connectivity"
	},
	// 5G/LTE
	{
		name: "Chateau 5G ax",
		category: "5G/LTE",
		icon: Globe,
		series: "5G Router",
		specs: [
			"5G NR modem",
			"Wi-Fi 6 (802.11ax)",
			"4x Gigabit Ethernet",
			"Dual SIM slots",
			"External antenna ports",
			"Desktop enclosure"
		],
		description: "5G home/office router with Wi-Fi 6",
		useCase: "5G primary/failover WAN, remote offices, temporary sites"
	},
	{
		name: "LtAP LTE kit",
		category: "5G/LTE",
		icon: Globe,
		series: "LTE Access Point",
		specs: [
			"LTE Cat-6 modem",
			"Wi-Fi dual-band",
			"GPS support",
			"Weatherproof",
			"Vehicle mounting",
			"PoE + DC input"
		],
		description: "Rugged vehicle LTE AP with GPS",
		useCase: "Mobile vehicles, buses, boats, outdoor events"
	},
	// Accessories
	{
		name: "S+RJ10",
		category: "Accessories",
		icon: Box,
		series: "SFP+ Module",
		specs: [
			"10GBASE-T transceiver",
			"RJ45 connector",
			"Cat6a cable support",
			"Up to 30m reach",
			"Low power consumption",
			"Hot-swappable"
		],
		description: "10G copper SFP+ module",
		useCase: "Short 10G copper links, server connectivity, switch uplinks"
	},
	{
		name: "ACUFL",
		category: "Accessories",
		icon: Radio,
		series: "U.FL Antenna",
		specs: [
			"Dual external antennas",
			"U.FL pigtails",
			"2.4GHz + 5GHz",
			"Magnetic mount base",
			"3m cables",
			"Omnidirectional pattern"
		],
		description: "External antenna set for better signal",
		useCase: "Improving LTE/5G signal, remote antenna placement, difficult RF environments"
	},
];

const CATEGORIES = ["All", "Routers", "Switches", "Wireless", "5G/LTE", "Accessories"];

// WhatsApp message generators
const generateProductInquiry = (product: Product): string => {
	const topSpecs = product.specs.slice(0, 3).map(spec => `• ${spec}`).join('\n');
	
	return `Hello NEXLYN Distribution,

I'm interested in the *${product.name}* (${product.series}) for business deployment.

*Product Details:*
${topSpecs}

*Use Case:* ${product.useCase}

*Please provide:*
• Reseller/volume pricing tiers
• Current stock availability
• Lead time for export orders
• Technical documentation
• Warranty & RMA process

*Company/Business:* [Your company name]
*Estimated quantity:* [Quantity needed]
*Delivery location:* [Country/Region]

Thank you!`;
};

const generateCategoryInquiry = (category: string): string => {
	const categoryProducts = PRODUCTS
		.filter(p => p.category === category)
		.map(p => `• ${p.name} (${p.series})`)
		.join('\n');
	
	return `Hello NEXLYN Distribution,

I'm interested in your *${category}* product category for business deployment.

*Products of interest:*
${categoryProducts}

*Please provide:*
• Product comparison & specifications
• Volume pricing structure
• Stock availability across range
• Recommended solutions for my use case

*Company/Business:* [Your company name]
*Use Case:* [Describe your needs]
*Estimated quantity:* [Quantity needed]
*Delivery location:* [Country/Region]

Thank you!`;
};

const generateResellerInquiry = (): string => {
	return `Hello NEXLYN Distribution,

I'm interested in becoming an *authorized MikroTik reseller* in your territory.

*Business Information:*
• Company name: [Your company]
• Current business: [Your current focus]
• Territory: [City/Region]
• Existing certifications: [Any relevant certs]
• Estimated monthly volume: [Units or value]

*I would like information about:*
• Reseller program requirements
• Volume pricing tiers
• Technical training opportunities
• Marketing support available
• RMA & warranty procedures

Thank you!`;
};

const generateGeneralInquiry = (): string => {
	return `Hello NEXLYN Distribution,

I'm interested in learning more about your MikroTik distribution services.

*Please provide information about:*
• Product catalog & availability
• B2B pricing structure
• Export capabilities
• Technical support services
• Reseller program

*Company/Business:* [Your company name]
*Territory:* [Country/Region]

Thank you!`;
};


// Memoized ProductCard component to prevent unnecessary re-renders
const ProductCard = memo(({ product, onClick }: { product: Product; onClick: () => void }) => {
	const Icon = product.icon;
	
	return (
		<div 
			className="rounded-lg border border-neutral-200 p-6 hover:shadow-xl hover:border-neutral-300 transition-all duration-300 transform hover:-translate-y-2 cursor-pointer bg-white"
			onClick={onClick}
		>
			<div className="w-full h-40 bg-gradient-to-br from-neutral-50 to-neutral-100 rounded-md mb-4 flex items-center justify-center">
				<Icon className="w-20 h-20 text-neutral-400" />
			</div>
			<h3 className="text-lg font-bold text-neutral-800 mb-1">
				{product.name}
			</h3>
			<p className="text-xs text-neutral-500 mb-3">{product.series}</p>
			<span className="inline-block bg-red-50 text-red-600 text-xs font-medium px-3 py-1 rounded-full mb-4">
				{product.category}
			</span>
			<p className="text-sm text-neutral-600 mb-4 line-clamp-2">
				{product.description}
			</p>
			<ul className="text-xs text-neutral-600 mb-6 space-y-1">
				{product.specs.slice(0, 3).map((spec) => (
					<li key={spec} className="flex items-start">
						<Check className="w-3 h-3 text-red-500 mr-2 mt-0.5 flex-shrink-0" />
						<span>{spec}</span>
					</li>
				))}
			</ul>
			<button
				className="w-full inline-flex items-center justify-center bg-red-600 text-white text-sm font-medium py-2.5 px-4 rounded-lg hover:bg-red-700 transition group"
			>
				View Details
				<ChevronRight className="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" />
			</button>
		</div>
	);
});
ProductCard.displayName = 'ProductCard';

// Product Modal Component
const ProductModal = memo(({ product, onClose }: { product: Product; onClose: () => void }) => {
	const Icon = product.icon;
	const whatsappMessage = generateProductInquiry(product);
	
	useEffect(() => {
		// Prevent body scroll when modal is open
		document.body.style.overflow = 'hidden';
		return () => {
			document.body.style.overflow = 'unset';
		};
	}, []);
	
	return (
		<div 
			className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4"
			onClick={onClose}
		>
			<div 
				className="bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl"
				onClick={(e) => e.stopPropagation()}
			>
				{/* Sticky Header */}
				<div className="sticky top-0 bg-white border-b border-neutral-200 px-6 py-4 flex items-start justify-between z-10">
					<div className="flex-1">
						<h2 className="text-2xl font-bold text-neutral-900 mb-1">{product.name}</h2>
						<p className="text-sm text-neutral-600">{product.series}</p>
					</div>
					<button
						onClick={onClose}
						className="ml-4 p-2 hover:bg-neutral-100 rounded-lg transition"
						aria-label="Close modal"
					>
						<X className="w-5 h-5 text-neutral-600" />
					</button>
				</div>
				
				{/* Content */}
				<div className="p-6">
					{/* Icon Display */}
					<div className="w-full h-48 bg-gradient-to-br from-neutral-50 to-neutral-100 rounded-lg mb-6 flex items-center justify-center">
						<Icon className="w-32 h-32 text-neutral-300" />
					</div>
					
					{/* Category Badge */}
					<span className="inline-block bg-red-50 text-red-600 text-sm font-medium px-4 py-1.5 rounded-full mb-4">
						{product.category}
					</span>
					
					{/* Description */}
					<p className="text-lg text-neutral-700 mb-6">{product.description}</p>
					
					{/* Technical Specifications */}
					<div className="mb-6">
						<h3 className="text-lg font-semibold text-neutral-900 mb-3 flex items-center">
							<Cpu className="w-5 h-5 mr-2 text-red-600" />
							Technical Specifications
						</h3>
						<div className="grid grid-cols-1 md:grid-cols-2 gap-3">
							{product.specs.map((spec, index) => (
								<div key={index} className="flex items-start">
									<Check className="w-4 h-4 text-red-500 mr-2 mt-0.5 flex-shrink-0" />
									<span className="text-sm text-neutral-700">{spec}</span>
								</div>
							))}
						</div>
					</div>
					
					{/* Use Case */}
					<div className="mb-6">
						<h3 className="text-lg font-semibold text-neutral-900 mb-3 flex items-center">
							<Server className="w-5 h-5 mr-2 text-red-600" />
							Typical Use Cases
						</h3>
						<p className="text-sm text-neutral-700 bg-neutral-50 p-4 rounded-lg">
							{product.useCase}
						</p>
					</div>
					
					{/* WhatsApp CTA */}
					<a
						href={`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`}
						target="_blank"
						rel="noopener noreferrer"
						className="w-full inline-flex items-center justify-center bg-green-600 text-white font-medium py-3 px-6 rounded-lg hover:bg-green-700 transition group"
					>
						<MessageCircle className="w-5 h-5 mr-2" />
						Inquire via WhatsApp
					</a>
				</div>
			</div>
		</div>
	);
});
ProductModal.displayName = 'ProductModal';


export default function Page() {
	const [currentSlide, setCurrentSlide] = useState(0);
	const [selectedCategory, setSelectedCategory] = useState("All");
	const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
	const featuredRef = useRef<HTMLDivElement | null>(null);

	useEffect(() => {
		const interval = setInterval(() => {
			setCurrentSlide((prev) => (prev + 1) % HERO_SLIDES.length);
		}, 6000); // 6 seconds as per requirements
		return () => clearInterval(interval);
	}, []);

	const filteredProducts = useMemo(
		() =>
			selectedCategory === "All"
				? PRODUCTS
				: PRODUCTS.filter((product) => product.category === selectedCategory),
		[selectedCategory]
	);

	const handleCategoryClick = useCallback((category: string) => {
		setSelectedCategory(category);
		featuredRef.current?.scrollIntoView({ behavior: "smooth" });
	}, []);

	const handleProductClick = useCallback((product: Product) => {
		setSelectedProduct(product);
	}, []);

	const handleCloseModal = useCallback(() => {
		setSelectedProduct(null);
	}, []);

	return (
		<main className="min-h-screen bg-white text-neutral-900">
			{/* Product Modal */}
			{selectedProduct && (
				<ProductModal product={selectedProduct} onClose={handleCloseModal} />
			)}
				{/* Hero Section */}
				<header
					className="relative w-full h-[500px] bg-gradient-to-b from-gray-100 to-white flex items-center justify-center"
				>
					<div className="absolute inset-0 bg-gradient-to-r from-gray-50 to-white opacity-90"></div>
					{HERO_SLIDES.map((slide, index) => (
						<div
							key={index}
							className={`absolute inset-0 flex flex-col items-center justify-center transition-opacity duration-1000 ${
								index === currentSlide ? "opacity-100" : "opacity-0"
							}`}
						>
							<h1 className="text-5xl font-extrabold text-neutral-800 mb-4">
								{slide.title}
							</h1>
							<p className="text-xl text-neutral-600 mb-6">
								{slide.subtitle}
							</p>
							<div className="flex gap-4">
								<a
									href={`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(
										"Hello, I’d like to enquire about MikroTik products"
									)}`}
									target="_blank"
									rel="noopener noreferrer"
									className="inline-block bg-red-600 text-white text-lg font-medium py-3 px-6 rounded-full hover:bg-red-700 transition"
								>
									WhatsApp Enquiry
								</a>
								<a
									href="#categories"
									className="inline-block border border-red-600 text-red-600 text-lg font-medium py-3 px-6 rounded-full hover:bg-red-50 transition"
								>
									View Products
								</a>
							</div>
						</div>
					))}

					{/* Pagination Dots */}
					<div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
						{HERO_SLIDES.map((_, index) => (
							<div
								key={index}
								className={`w-3 h-3 rounded-full transition-colors duration-300 ${
									index === currentSlide ? "bg-red-600" : "bg-gray-300"
								}`}
							></div>
						))}
					</div>
				</header>

				{/* Trust / Positioning Strip */}
				<section className="bg-gray-50 py-8">
					<div className="mx-auto max-w-6xl px-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
						<div className="p-4">
							<div className="text-2xl font-bold text-red-600 mb-2">✓</div>
							<p className="text-sm text-neutral-700">
								Official MikroTik Distributor
							</p>
						</div>
						<div className="p-4">
							<div className="text-2xl font-bold text-red-600 mb-2">✓</div>
							<p className="text-sm text-neutral-700">
								Serving UAE, GCC & Export Markets
							</p>
						</div>
						<div className="p-4">
							<div className="text-2xl font-bold text-red-600 mb-2">✓</div>
							<p className="text-sm text-neutral-700">
								B2B Pricing for Resellers
							</p>
						</div>
						<div className="p-4">
							<div className="text-2xl font-bold text-red-600 mb-2">✓</div>
							<p className="text-sm text-neutral-700">Fast Logistics</p>
						</div>
					</div>
				</section>

				{/* Categories Section */}
				<section id="categories" className="mx-auto max-w-6xl px-4 py-14">
					<h2 className="text-3xl font-semibold mb-6">Categories</h2>
					<div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6">
						{CATEGORIES.map((category) => (
							<button
								key={category}
								onClick={() => handleCategoryClick(category)}
								className={`p-4 rounded-lg border text-sm font-medium transition-all duration-300 shadow-sm hover:shadow-md ${
									selectedCategory === category
										? "bg-red-600 text-white border-red-600"
										: "border-neutral-300 text-neutral-700 hover:bg-neutral-100"
								}`}
								aria-pressed={selectedCategory === category}
							>
								{category}
							</button>
						))}
					</div>
				</section>

				{/* Featured Products Section */}
				<section ref={featuredRef} className="mx-auto max-w-6xl px-4 py-14">
					<h2 className="text-3xl font-semibold mb-6">
						Featured MikroTik Products
					</h2>
					<div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
						{filteredProducts.map((product) => (
							<ProductCard key={product.name} product={product} />
						))}
					</div>
				</section>

				{/* Footer */}
				<footer className="border-t mt-14">
					<div className="mx-auto max-w-6xl px-4 py-8 text-center text-sm text-neutral-600">
						<div className="font-medium text-neutral-800 mb-2">
							NEXLYN DISTRIBUTION LLC
						</div>
						<div className="mb-2">UAE · GCC · Export</div>
						<div className="mb-4">Contact: +971 502474482</div>
						<p className="text-xs text-neutral-500 mb-4">
							MikroTik® is a registered trademark of MikroTik. NEXLYN Distribution LLC
							is an independent distributor.
						</p>
						<p className="text-xs text-neutral-400">
							Site direction & UX by
							<a
								href="#"
								target="_blank"
								rel="noopener noreferrer"
								className="text-neutral-500 hover:text-neutral-700 ml-1"
							>
								Vishnu Madhav
							</a>
						</p>
					</div>
				</footer>
			</main>
	);
}